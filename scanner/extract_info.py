import pefile
import lief
import zipfile
import tarfile
import io


lief.logging.disable()


class FileExtract:
	def __int__(self, file_data):
		self.file = file_data

	def get_info(self):
		try:
			if lief.is_pe(self.file):
				resources=[]
				hashes ={}
				pe_data = pefile.PE(data=self.file)
				pe_file = lief.PE.parse(self.file)
				hashes['md5'] = pe_data.get_rich_header_hash('md5')
				hashes['sha256'] = pe_data.get_rich_header_hash('sha256')
				headers={}
				headers['magic'] = "PE32" if pe_file.optional_header.magic == lief.PE.PE_TYPE.PE32 else "PE64"

				for entry in pe_data.DIRECTORY_ENTRY_IMPORT:
					entries={'dll': entry.dll}
					imports=[]
					for impor in entry.imports:
						imports.append(impor)
					entries['imports'] = imports
					resources.append(entries)
				return headers, hashes, resources

			elif lief.is_elf(self.file):
				return "ELF"
			elif lief.is_macho(self.file):
				return "Mach-O"
			elif lief.is_dex(self.file):
				return "DEX"
			elif zipfile.is_zipfile(self.file):
				return "ZIP"
			elif tarfile.is_tarfile(self.file):
				return "TAR"

		except:
			return "Unknown format"



